#!/bin/bash


host_ip=$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1')
solr_version = ARGV[0]
solr_port = ARGV[1]
solr_running=$(ps -ef|grep solr)


live_node_list = ''
if [[ $solr_running =~ "-DzkHost=" ]] ; then
  if [[ $solr_version == 4.* ]] ; then
  	live_node_list=$(curl --silent "http://$host_ip:8080/solr/admin/collections?action=CLUSTERSTATUS&wt=json" | grep -oP '(?<="live_nodes":).*?(])');
  fi
  if [[ $solr_version == 5.* ] -o [ $solr_version == 6.* ]] ; then
  	live_node_list=$(curl --silent "http://$host_ip:$solr_port/solr/admin/collections?action=CLUSTERSTATUS&wt=json" | grep -oP '(?<="live_nodes":).*?(])');
  fi
  if [[ $live_node_list =~ $hostip ]] ; then
    echo "solrcloud is up |up=100"
  else
    echo "solrcloud is down |up=0"
  fi
else
  echo "SolrCloud is not running"
fi


